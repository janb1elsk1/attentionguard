# Attention Guard â€“ Focus Timer Chrome Extension

A modern, lightweight Chrome extension (Manifest V3) for maintaining focus and fighting procrastination. Features a draggable floating timer panel, persistent Pomodoro-style session tracking, and a "panic button" system with customizable motivational reminders.

## âœ¨ Features

- **Floating Timer Panel** â€“ Draggable, always-visible overlay with modern UI
- **Persistent Focus Sessions** â€“ Timer continues across page navigation and tab reloads within the same tab
- **Pomodoro Cycles** â€“ Set multiple work-break cycles with automatic progression (e.g., 3 blocks Ã— 25min + 5min breaks)
- **Panic Button System** â€“ Quick access to motivational reminders when you feel distracted
- **Fully Customizable** â€“ Edit session duration, break time, number of blocks, and panic button content locally
- **Offline & Private** â€“ All data stored locally in `chrome.storage.local`, no backend or sync
- **Minimal Distraction** â€“ Lightweight, non-intrusive design inspired by floating timer apps

## ğŸ“¦ Tech Stack

- **TypeScript** â€“ For better type safety and developer experience
- **Manifest V3** â€“ Modern Chrome Extension standard
- **Vanilla JS + CSS** â€“ No heavy frameworks, just clean code
- **Chrome Storage API** â€“ Local persistence without backend

## ğŸš€ Quick Start

### 1. Install Dependencies

```bash
npm install
```

### 2. Build the Extension

```bash
npm run build
```

This compiles TypeScript files from `src/` to `dist/`.

### 3. Load into Chrome

1. Open Chrome and go to `chrome://extensions/`
2. Enable **Developer mode** (top-right corner)
3. Click **Load unpacked**
4. Select the project folder (`timerpanic`)
5. The extension should now appear in your extensions list

### 4. Test the Extension

1. **Visit any website** (e.g., `google.com`, `github.com`)
2. You should see the **Attention Guard floating panel** in the top-left corner
3. **Test Pomodoro Cycles:**
   - Click the gear icon (âš™) to open Settings
   - Set "Pomodoro Blocks" to 3 (for example)
   - Set "Session Duration" to 1 minute (for quick testing)
   - Set "Break Duration" to 10 seconds (for quick testing)
   - Click "Save Settings"
   - Click the green "Start" button
   - Timer will count down for 1 minute (Block 1/3)
   - After 1 minute, break automatically starts (10 seconds)
   - After break, Block 2/3 starts automatically
   - Repeat until all 3 blocks are done
4. **Start a focus session:**
   - Click the green "Start" button
   - Timer counts down from 25 minutes (default)
5. **Navigate between pages** in the same tab â€“ the timer keeps running!
6. **Panic Button:**
   - Click the red "PANIC" button
   - See default motivational reminders
   - Click "Back to Focus" to dismiss and resume timer from where it was paused
7. **Customize Settings:**
   - Click the gear icon (âš™)
   - Adjust session/break duration
   - **Adjust Pomodoro blocks** (e.g., 2, 4, or 5 cycles)
   - Edit panic button content
   - Click "Save Settings"
8. **Drag the panel** around the screen â€“ position is saved

## ğŸ“‚ Project Structure

```
timerpanic/
â”œâ”€â”€ manifest.json          # Extension manifest (MV3)
â”œâ”€â”€ package.json           # Dependencies
â”œâ”€â”€ tsconfig.json          # TypeScript config
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ background.ts      # Service worker (timer state management)
â”‚   â”œâ”€â”€ content.ts         # Content script (UI injection & interaction)
â”‚   â”œâ”€â”€ storage.ts         # Storage utilities (chrome.storage.local helpers)
â”‚   â””â”€â”€ styles.css         # Floating panel styles
â””â”€â”€ dist/                  # Compiled output (auto-generated by npm run build)
    â”œâ”€â”€ background.js
    â”œâ”€â”€ content.js
    â””â”€â”€ styles.css
```

## ğŸ”§ How It Works

### Architecture

1. **Service Worker** (`background.ts`)
   - Manages global timer state
   - Keeps track of session start time and duration
   - Broadcasts timer updates to all content scripts

2. **Content Scripts** (`content.ts`)
   - Injects floating panel on every page
   - Listens to storage changes and background messages
   - Updates UI based on timer state
   - Handles user interactions (drag, buttons, modals)

3. **Storage** (`storage.ts`)
   - Type-safe wrappers around `chrome.storage.local`
   - Stores timer state, user settings, panic content
   - All data persists between browser sessions

### Timer Persistence

The timer keeps running because:

- **Start time** and **planned duration** are stored in `chrome.storage.local`
- On each page load, the content script:
  1. Reads the stored state
  2. Calculates remaining time: `remaining = duration - (now - startTime)`
  3. Updates the display with accurate remaining time
  4. No timer reset on page navigation

### Panic Button Customization

- Default reminders are editable through the Settings modal
- User-defined content is saved to storage
- Panic modal displays all custom reminders
- Changes sync across all tabs in real-time

### Pomodoro Cycles

The extension supports multiple Pomodoro cycles:

- **Set block count** â€“ Configure how many work-break cycles to run (e.g., 3 blocks)
- **Automatic progression** â€“ After each break, the next work block automatically starts
- **Block counter** â€“ Current block number is displayed in the panel (e.g., "Block 1/3")
- **Customizable durations** â€“ Each block and break duration can be adjusted in Settings
- **Completion logic**:
  1. Work session runs for X minutes (e.g., 25 min)
  2. Break starts automatically for Y minutes (e.g., 5 min)
  3. Next work block begins automatically
  4. After last break, timer stops and resets
- **Manual pause/resume** â€“ You can pause at any time and resume from where you left off
- **Panic integration** â€“ Panic button pauses the current cycle and resumes when dismissed

## ğŸ¨ UI Overview

### Main Panel

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Attention Guard âˆ’  Ã— â•‘  â† Header (draggable)
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘      25:00         â•‘  â† Time display
â•‘      Working...    â•‘  â† Status (Working/Break/Ready)
â•‘   Block 1/3        â•‘  â† Current block progress
â•‘  [Start] [Reset]   â•‘  â† Controls
â•‘  [âš™] [PANIC]       â•‘  â† Settings & Panic
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Panic Modal

Shows customizable motivational reminders:

```
What is the ONE most important step right now?
Why did you start this session?
You've got this. Break it into smaller pieces.
```

### Settings Modal

- Session duration (minutes)
- Break duration (minutes)
- **Pomodoro blocks** (number of cycles)
- Panic button title
- Panic button content (textarea)

## ğŸ”Œ Message Flow

```
Background Worker â†â†’ Content Script(s)
     â†“
   Storage (chrome.storage.local)
     â†“
   Content Script UI updates
```

**Actions:**

- `startTimer` â€“ Content sends to background
- `pauseTimer` â€“ Content sends to background
- `resetTimer` â€“ Content sends to background
- `timerStateChanged` â€“ Background broadcasts to all contents
- `timerTick` â€“ Background sends ~10x per second
- `timerFinished` â€“ Background notifies when time's up

## ğŸ› ï¸ Development

### Watch Mode (Auto-compile)

```bash
npm run watch
```

Then reload the extension in Chrome after changes (`chrome://extensions/` â†’ click refresh icon).

### Clean Build

```bash
npm run clean
npm run build
```

## ğŸ“ Customization

### Change Default Panic Content

Edit the default in `src/storage.ts`:

```typescript
panicContent: {
  title: "Stay focused on your task",
  items: [
    "What is the ONE most important step right now?",
    "Why did you start this session?",
    // ... add your own
  ]
}
```

### Adjust Default Session Length

In `src/storage.ts`:

```typescript
DEFAULT_SETTINGS: UserSettings = {
  sessionMinutes: 25,  // Change this
  // ...
}
```

### Change Panel Position

Default top-left (`x: 20, y: 20`):

```typescript
panelPosition: { x: 20, y: 20 }  // Adjust here
```

## ğŸ› Troubleshooting

### Timer doesn't persist across pages

- Check that you're staying on the **same tab**
- Verify timer state in `chrome://extensions/` â†’ Attention Guard â†’ Details â†’ Storage
- Try a full reload: `Ctrl+Shift+R` (force refresh)

### Panel not appearing

- Check `chrome://extensions/` â€“ is extension enabled?
- Try clearing storage: Go to extension details â†’ "Delete data"
- Reload the page

### Styles not updating

- Delete `dist/` folder: `npm run clean`
- Rebuild: `npm run build`
- Reload extension in Chrome

## ğŸ™ Publishing to GitHub (app + Privacy Policy)

1. **Initialize and push:** In the project folder run `git init`, then `git add .` and `git commit -m "Initial commit"`.
2. **Create a new repository** on [GitHub](https://github.com/new) (e.g. name: `timerpanic`), do **not** add README.
3. **Connect and push:** `git remote add origin https://github.com/YOUR-USERNAME/timerpanic.git`, then `git branch -M main` and `git push -u origin main`.
4. **Enable GitHub Pages:** In the repo go to **Settings â†’ Pages â†’ Source: Deploy from a branch** â†’ branch `main`, folder **/ (root)** â†’ Save. After a minute, the privacy policy will be available at `https://YOUR-USERNAME.github.io/timerpanic/privacy.html` (use this URL in Chrome Web Store as the privacy policy link).

## ğŸ“¦ Publishing to Chrome Web Store

1. **Generate icons:** Open `icons/generate-icons.html` in Chrome and save the three PNGs into the `icons/` folder (`icon16.png`, `icon48.png`, `icon128.png`).
2. **Create package:** Run `npm run pack:store` to build and create `attention-guard-v1.0.0.zip`.
3. **Publish:** Upload the ZIP to the [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole).

Full steps, store listing text, privacy policy, and checklist: see **[CHROME_WEB_STORE_PUBLISH.md](CHROME_WEB_STORE_PUBLISH.md)** and **[STORE_LISTING.md](STORE_LISTING.md)**.

## ğŸ“„ License

MIT â€“ Use freely, modify as needed.

---

**Made with â¤ï¸ for focused work. Happy timer-ing! â±ï¸**
